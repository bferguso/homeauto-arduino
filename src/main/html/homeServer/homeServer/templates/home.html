<!doctype html>
<html lang="en">
<head>
    <title>Ferginzeys' Home - Main Menu</title>
    <!-- Latest compiled and minified CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <!-- Optional theme -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-theme.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ferginzey.css') }}"/>

    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>

    <script>
        //var ipAddress = "{{ ip }}";
        //var ipAddress = "192.168.102.124";
        /*
        $().ready(function () {
            $("#sensorIp").text(ipAddress);
        });
         */
        var updateSensorLocation = function (ipAddress) {
            var newLocation = $("#sensorLocationText_"+ipAddress).val();
            $.ajax({
                method: "GET",
                url: "http://" + ipAddress + "/updateConfig?physicalLocation=" + newLocation,
                success: function (msg) {
                    console.log(msg);
                    $("#resultMessage").text(msg);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("Ajax call failed: " + textStatus + ": " + errorThrown);
                    alert("Unable to update location.");
                }
            });
        }
    </script>
</head>
<body>
<div class="ferginzey_title">Ferginzeys' Home Data</div>
<div class="nav_links">
    <div class="nav_link"><a href="/homeServer/hourlySummary">Hourly Summary</a></div>
    <div class="nav_link"><a href="/homeServer/dailySummary">Daily Summary</a></div>
</div>
<hr>
<div>Current Readings</div>
<div id="rawDataTable" class="table active" style="padding-left: 100px;">
    <div class="row">
        <div class="col-sm-1 col-md-1 env_reading_title">Location</div>
        <div class="col-sm-2 col-md-2 env_reading_title">Address</div>
        <div class="col-sm-3 col-md-3 env_reading_title">Last Seen</div>
        <div class="col-sm-1 col-md-1 number env_reading_title">Temp</div>
        <div class="col-sm-1 col-md-1 number env_reading_title">Humidity</div>
        <div class="col-sm-1 col-md-1 number env_reading_title">Pressure</div>
    </div>
    {% for location in latest_env %}
    <div class="row">
        <div class="col-sm-1 col-md-1 env_reading_title">{{location.sensor_location}}</div>
        <div class="col-sm-2 col-md-2">{{location.remote_address}}</div>
        <div class="col-sm-3 col-md-3">{{location.last_seen_timestamp}}</div>
        <div class="col-sm-1 col-md-1 number">{{location.last_reading.temperature}}</div>
        <div class="col-sm-1 col-md-1 number">{{location.last_reading.humidity}}%</div>
        <div class="col-sm-1 col-md-1 number">{{location.last_reading.pressure}}</div>
    </div>
    {% endfor %}
</div>
<form>
    <div class="env_reading_title">Update Configuration</div>
    {% for location in latest_env %}
    <div id="resultMessage" class="alert-success"></div>
    <label for="sensorLocationText_{{location.remote_address}}"><span id="sensorIp_{{ location.remote_address }}">{{location.remote_address}}</span></label>
    <input id="sensorLocationText_{{location.remote_address}}" type="text" value="{{location.sensor_location}}"/>
    <input id="publishHost_{{location.remote_address}}" type="text" value="192.168.102.178"/>
    <input id="publishUrl_{{location.remote_address}}" type="text"  size="30" value="/homeServer/logEnv?envJson="/>
    <button class="btn btn-link" onclick="updateSensorLocation('{{location.remote_address}}'); return false;" value="Update Location"><span
            class="glyphicon glyphicon-refresh"></span></button>
    {% endfor %}
</form>
<hr>
</body>
</html>